<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Fast Food Menu</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; }
        .menu { display: flex; flex-wrap: wrap; gap: 16px; max-width: 400px; margin: 40px auto; }
        .item { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 16px; width: 120px; text-align: center; }
        .item img { width: 48px; height: 48px; }
        .counter-block {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 8px;
        }
        .counter-btn {
            background: #ffb300;
            border: none;
            border-radius: 5px;
            width: 32px;
            height: 32px;
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        .counter-btn:active {
            background: #e69500;
        }
        .counter-value {
            min-width: 28px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #1a8f1a;
        }
        .add-btn {
            margin-top: 8px;
            background: #ffb300;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        .add-btn:active {
            background: #e69500;
        }
        .input-block { display: flex; justify-content: center; align-items: center; gap: 8px; margin: 30px auto 0 auto; }
        .input-block input { width: 60px; padding: 6px; font-size: 18px; border-radius: 5px; border: 1px solid #ccc; text-align: center; }
        .input-block button { background: #1a8f1a; color: #fff; border: none; border-radius: 5px; padding: 6px 14px; font-weight: bold; cursor: pointer; }
        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .cart-box {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 280px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px #0002;
            padding: 18px 16px 16px 16px;
            z-index: 100;
        }
        .cart-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #222;
        }
        .cart-list {
            max-height: 120px;
            overflow-y: auto;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .cart-total {
            font-weight: bold;
            margin-bottom: 12px;
            text-align: right;
            color: #1a8f1a;
        }
        .cart-btn {
            width: 100%;
            margin-bottom: 8px;
            padding: 8px 0;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .promo-btn {
            background: #1a8f1a;
            color: #fff;
        }
        .pay-btn {
            background: #ffb300;
            color: #fff;
        }
        /* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ */
        .promo-list-box {
            position: fixed;
            right: 24px;
            bottom: 320px;
            width: 280px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px #0002;
            padding: 14px 16px 14px 16px;
            z-index: 99;
        }
        .promo-list-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #222;
        }
        .promo-list {
            font-size: 15px;
        }
        .promo-list li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="input-block">
        <input type="number" id="userNumber" placeholder="–ß–∏—Å–ª–æ">
        <button onclick="updateNumberLot()">–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ—Ç-—á–∏—Å–ª–æ</button>
    </div>
    <div class="menu" id="menu"></div>
    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ -->
    <div class="promo-list-box">
        <div class="promo-list-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã:</div>
        <ul class="promo-list" id="promoList"></ul>
    </div>
    <div class="cart-box" id="cartBox" style="display:none"></div>
    <script>
        // –ü—Ä–æ–º–æ–∫–æ–¥—ã: –∫–æ–¥ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
        const promoCodes = [
            { code: 'FOOD10', desc: '–°–∫–∏–¥–∫–∞ 10% –Ω–∞ –≤—Å—ë', discount: 0.10 },
            { code: 'FAST50', desc: '–°–∫–∏–¥–∫–∞ 50 —Ä—É–±–ª–µ–π –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 300 —Ä—É–±–ª–µ–π', discount: 50, min: 300 },
            { code: 'WELCOME', desc: '–°–∫–∏–¥–∫–∞ 20 —Ä—É–±–ª–µ–π –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤', discount: 20 }
        ];

        // –õ–æ—Ç-—á–∏—Å–ª–æ –≤—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤ –º–∞—Å—Å–∏–≤–µ!
        const menu = [
            { name: '–ë—É—Ä–≥–µ—Ä', price: 250, img: 'üçî' },
            { name: '–§—Ä–∏', price: 150, img: 'üçü' },
            { name: '–•–æ—Ç–¥–æ–≥', price: 200, img: 'üå≠' },
            { name: '–¢–∞–∫–æ', price: 400, img: 'üåÆ' },
            { name: '–ü–∏—Ü—Ü–∞', price: 800, img: 'üçï' },
            { name: '7', img: 'üî¢', isNumberLot: true }
        ];

        const counters = {}; // { idx: count }
        const cart = {};
        let appliedPromo = null;

        function getPrice(item) {
            if (item.isNumberLot && !isNaN(item.name)) {
                return Math.floor(Number(item.name) * 5.5);
            }
            return item.price;
        }

        function renderMenu() {
            const menuDiv = document.getElementById('menu');
            menuDiv.innerHTML = '';
            menu.forEach((item, idx) => {
                const price = getPrice(item);
                let html = `
                    <div class="item">
                        <div style="font-size:32px">${item.img}</div>
                        <div>${item.name} - ${price} —Ä—É–±–ª–µ–π</div>
                `;
                if (item.isNumberLot) {
                    html += `<button class="add-btn" onclick="addToCart(${idx})">–î–æ–±–∞–≤–∏—Ç—å</button>`;
                } else if (counters[idx]) {
                    html += `
                        <div class="counter-block">
                            <button class="counter-btn" onclick="decrement(${idx})">-</button>
                            <span class="counter-value" id="counter-${idx}">${counters[idx]}</span>
                            <button class="counter-btn" onclick="increment(${idx})">+</button>
                        </div>
                    `;
                } else {
                    html += `<button class="add-btn" onclick="showCounter(${idx})">–î–æ–±–∞–≤–∏—Ç—å</button>`;
                }
                html += `</div>`;
                menuDiv.innerHTML += html;
            });
            renderCart();
        }

        window.showCounter = function(idx) {
            counters[idx] = 1;
            cart[idx] = 1;
            renderMenu();
        }

        window.increment = function(idx) {
            counters[idx]++;
            cart[idx] = counters[idx];
            renderMenu();
        }

        window.decrement = function(idx) {
            if (counters[idx] > 1) {
                counters[idx]--;
                cart[idx] = counters[idx];
            } else {
                delete counters[idx];
                delete cart[idx];
            }
            renderMenu();
        }

        window.addToCart = function(idx) {
            const item = menu[idx];
            const price = getPrice(item);
            cart[idx] = (cart[idx] || 0) + 1;
            Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            Telegram.WebApp.showPopup({
                title: "–î–æ–±–∞–≤–ª–µ–Ω–æ!",
                message: `${item.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É.`,
                buttons: [{id: 'ok', type: 'close', text: '–û–ö'}]
            });
            renderCart();
        }

        window.updateNumberLot = function() {
            const input = document.getElementById('userNumber');
            const value = input.value.trim();
            if (value === '' || isNaN(value)) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ!');
                return;
            }
            const numberLot = menu.find(item => item.isNumberLot);
            numberLot.name = value;
            input.value = '';
            renderMenu();
        }

        // –ö–æ—Ä–∑–∏–Ω–∞
        function renderCart() {
            const cartBox = document.getElementById('cartBox');
            const items = Object.keys(cart)
                .filter(idx => cart[idx] > 0)
                .map(idx => ({...menu[idx], count: cart[idx], idx: Number(idx)}));
            if (items.length === 0) {
                cartBox.style.display = 'none';
                appliedPromo = null;
                return;
            }
            let total = 0;
            let listHtml = '';
            items.forEach(item => {
                const price = getPrice(item);
                total += price * item.count;
                listHtml += `<div class="cart-item">
                    <span>${item.img} ${item.name} √ó ${item.count}</span>
                    <span>${price * item.count} —Ä—É–±.</span>
                </div>`;
            });

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
            let promoText = '';
            let discount = 0;
            if (appliedPromo) {
                if (appliedPromo.discount < 1) {
                    // –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞
                    discount = Math.floor(total * appliedPromo.discount);
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (-${discount} —Ä—É–±.)`;
                } else if (appliedPromo.min && total >= appliedPromo.min) {
                    discount = appliedPromo.discount;
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (-${discount} —Ä—É–±.)`;
                } else if (!appliedPromo.min) {
                    discount = appliedPromo.discount;
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (-${discount} —Ä—É–±.)`;
                } else {
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ª–æ–≤–∏—è)`;
                }
            }
            let totalWithDiscount = Math.max(total - discount, 0);

            cartBox.innerHTML = `
                <div class="cart-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <div class="cart-list">${listHtml}</div>
                <div class="cart-total">–ò—Ç–æ–≥–æ: ${totalWithDiscount} —Ä—É–±–ª–µ–π</div>
                ${promoText ? `<div style="color:#1a8f1a; font-size:14px; margin-bottom:8px;">${promoText}</div>` : ''}
                <button class="cart-btn promo-btn" onclick="showPromo()">–ü—Ä–æ–º–æ–∫–æ–¥</button>
                <button class="cart-btn pay-btn" onclick="payOrder()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            `;
            cartBox.style.display = 'block';
        }

        window.showPromo = function() {
            const code = prompt('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:');
            if (!code) return;
            const promo = promoCodes.find(p => p.code.toLowerCase() === code.trim().toLowerCase());
            if (promo) {
                appliedPromo = promo;
                alert('–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!');
            } else {
                appliedPromo = null;
                alert('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω.');
            }
            renderCart();
        }

        window.payOrder = function() {
            alert('–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ (–ø—Ä–∏–º–µ—Ä)');
        }

        // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
        function renderPromoList() {
            const promoList = document.getElementById('promoList');
            promoList.innerHTML = promoCodes.map(p =>
                `<li><b>${p.code}</b> ‚Äî ${p.desc}</li>`
            ).join('');
        }

        renderPromoList();
        renderMenu();
    </script>
</body>
</html>
