<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Fast Food Menu</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; margin:0; }
        .menu { display: flex; flex-wrap: wrap; gap: 16px; max-width: 400px; margin: 40px auto; }
        .item { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 16px; width: 120px; text-align: center; }
        .item img { width: 48px; height: 48px; }
        .counter-block {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 8px;
        }
        .counter-btn {
            background: #ffb300;
            border: none;
            border-radius: 5px;
            width: 32px;
            height: 32px;
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }
        .counter-btn:active {
            background: #e69500;
            transform: scale(0.92);
        }
        .counter-value {
            min-width: 28px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #1a8f1a;
        }
        .add-btn {
            margin-top: 8px;
            background: #ffb300;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }
        .add-btn:active {
            background: #e69500;
            transform: scale(0.96);
        }
        .input-block { display: flex; justify-content: center; align-items: center; gap: 8px; margin: 30px auto 0 auto; }
        .input-block input { width: 60px; padding: 6px; font-size: 18px; border-radius: 5px; border: 1px solid #ccc; text-align: center; }
        .input-block button { background: #1a8f1a; color: #fff; border: none; border-radius: 5px; padding: 6px 14px; font-weight: bold; cursor: pointer; }
        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .cart-box {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 280px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px #0002;
            padding: 18px 16px 16px 16px;
            z-index: 100;
            opacity: 0;
            transform: translateY(30px) scale(0.98);
            pointer-events: none;
            transition: opacity 0.35s cubic-bezier(.4,1.4,.6,1), transform 0.35s cubic-bezier(.4,1.4,.6,1);
        }
        .cart-box.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }
        .cart-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #222;
        }
        .cart-list {
            max-height: 120px;
            overflow-y: auto;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .cart-total {
            font-weight: bold;
            margin-bottom: 12px;
            text-align: right;
            color: #1a8f1a;
        }
        .cart-btn {
            width: 100%;
            margin-bottom: 8px;
            padding: 8px 0;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }
        .pay-btn {
            background: #ffb300;
            color: #fff;
        }
        .pay-btn:active {
            background: #e69500;
            transform: scale(0.97);
        }
        /* --- –ü—Ä–æ–º–æ–∫–æ–¥ --- */
        .promo-input-block {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        .promo-input-block input,
        .promo-input-block .promo-btn-apply {
            height: 40px;
            box-sizing: border-box;
        }
        .promo-input-block input {
            flex: 0 1 65%;
            min-width: 110px;
            max-width: 200px;
            padding: 7px 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .promo-input-block input:focus {
            border-color: #1a8f1a;
            outline: none;
        }
        .promo-input-block .promo-btn-apply {
            flex: 0 1 35%;
            width: 0;
            background: #1a8f1a;
            color: #fff;
            border: none;
            border-radius: 7px;
            padding: 0;
            font-size: 15px;
            min-width: 44px;
            max-width: 90px;
            font-weight: bold;
            box-shadow: 0 2px 8px #0001;
            cursor: pointer;
            line-height: 1;
            transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .promo-input-block .promo-btn-apply:active {
            background: #146d13;
            box-shadow: 0 1px 4px #0002;
            transform: scale(1.04);
        }
        .promo-message {
            color: #d32f2f;
            font-size: 14px;
            margin-bottom: 8px;
            text-align: center;
        }
        .promo-message.success {
            color: #1a8f1a;
        }
        /* –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ */
        #togglePromoList {
            position: fixed;
            right: 24px;
            bottom: 320px;
            z-index: 101;
            background: #1a8f1a;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px #0002;
            transition: background 0.2s, transform 0.1s;
        }
        #togglePromoList:active {
            background: #146d13;
            transform: scale(0.97);
        }
        /* –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ */
        .promo-list-box {
            position: fixed;
            right: 24px;
            bottom: 370px;
            width: 280px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px #0002;
            padding: 14px 16px 14px 16px;
            z-index: 102;
            max-height: 180px;
            overflow-y: auto;
            display: none;
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            transition: opacity 0.35s cubic-bezier(.4,1.4,.6,1), transform 0.35s cubic-bezier(.4,1.4,.6,1);
        }
        .promo-list-box.visible {
            display: block;
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .promo-list-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #222;
        }
        .promo-list {
            font-size: 15px;
        }
        .promo-list li {
            margin-bottom: 4px;
        }
        @media (max-width: 600px) {
            .cart-box, .promo-list-box, #togglePromoList {
                right: 8px;
            }
            .cart-box, .promo-list-box {
                width: 96vw;
                min-width: 0;
                max-width: 99vw;
            }
            .menu {
                gap: 8px;
                max-width: 99vw;
            }
            .item {
                width: 44vw;
                min-width: 140px;
                max-width: 180px;
                padding: 10px;
            }
            .promo-input-block input,
            .promo-input-block .promo-btn-apply {
                height: 34px;
            }
            .promo-input-block input {
                font-size: 14px;
                min-width: 70px;
            }
            .promo-input-block .promo-btn-apply {
                font-size: 14px;
                min-width: 38px;
                max-width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="input-block">
        <input type="number" id="userNumber" placeholder="–ß–∏—Å–ª–æ" />
        <button onclick="updateNumberLot()">–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ—Ç-—á–∏—Å–ª–æ</button>
    </div>
    <div class="menu" id="menu"></div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ -->
    <button id="togglePromoList">–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã</button>

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤, —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
    <div class="promo-list-box" id="promoListBox">
        <div class="promo-list-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã:</div>
        <ul class="promo-list" id="promoList"></ul>
    </div>

    <div class="cart-box" id="cartBox"></div>

    <script>
        // –ü—Ä–æ–º–æ–∫–æ–¥—ã: –∫–æ–¥ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
        const promoCodes = [
            { code: 'FOOD10', desc: '–°–∫–∏–¥–∫–∞ 10% –Ω–∞ –≤—Å—ë', discount: 0.10 },
            { code: 'FAST50', desc: '–°–∫–∏–¥–∫–∞ 50 —Ä—É–±–ª–µ–π –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 300 —Ä—É–±–ª–µ–π', discount: 50, min: 300 },
            { code: 'WELCOME', desc: '–°–∫–∏–¥–∫–∞ 20 —Ä—É–±–ª–µ–π –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤', discount: 20 }
        ];

        const menu = [
            { name: '–ë—É—Ä–≥–µ—Ä', price: 4.99, img: 'üçî' },
            { name: '–§—Ä–∏', price: 1.49, img: 'üçü' },
            { name: '–•–æ—Ç–¥–æ–≥', price: 3.49, img: 'üå≠' },
            { name: '–¢–∞–∫–æ', price: 3.99, img: 'üåÆ' },
            { name: '–ü–∏—Ü—Ü–∞', price: 7.99, img: 'üçï' },
            { name: '7', img: 'üî¢', isNumberLot: true }
        ];

        const counters = {}; // { idx: count }
        const cart = {};
        let appliedPromo = null;
        let promoMessage = '';

        function getPrice(item) {
            if (item.isNumberLot && !isNaN(item.name)) {
                return Math.floor(Number(item.name) * 5.5);
            }
            return item.price;
        }

        function renderMenu() {
            const menuDiv = document.getElementById('menu');
            menuDiv.innerHTML = '';
            menu.forEach((item, idx) => {
                const price = getPrice(item);
                let html = `
                    <div class="item">
                        <div style="font-size:32px">${item.img}</div>
                        <div>${item.name} - ${price} —Ä—É–±–ª–µ–π</div>
                `;
                if (item.isNumberLot) {
                    html += `<button class="add-btn" onclick="addToCart(${idx})">–î–æ–±–∞–≤–∏—Ç—å</button>`;
                } else if (counters[idx]) {
                    html += `
                        <div class="counter-block">
                            <button class="counter-btn" onclick="decrement(${idx})">-</button>
                            <span class="counter-value" id="counter-${idx}">${counters[idx]}</span>
                            <button class="counter-btn" onclick="increment(${idx})">+</button>
                        </div>
                    `;
                } else {
                    html += `<button class="add-btn" onclick="showCounter(${idx})">–î–æ–±–∞–≤–∏—Ç—å</button>`;
                }
                html += `</div>`;
                menuDiv.innerHTML += html;
            });
            renderCart();
        }

        window.showCounter = function(idx) {
            counters[idx] = 1;
            cart[idx] = 1;
            renderMenu();
        }

        window.increment = function(idx) {
            counters[idx]++;
            cart[idx] = counters[idx];
            renderMenu();
        }

        window.decrement = function(idx) {
            if (counters[idx] > 1) {
                counters[idx]--;
                cart[idx] = counters[idx];
            } else {
                delete counters[idx];
                delete cart[idx];
            }
            renderMenu();
        }

        window.addToCart = function(idx) {
            const item = menu[idx];
            const price = getPrice(item);
            cart[idx] = (cart[idx] || 0) + 1;
            Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            Telegram.WebApp.showPopup({
                title: "–î–æ–±–∞–≤–ª–µ–Ω–æ!",
                message: `${item.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É.`,
                buttons: [{id: 'ok', type: 'close', text: '–û–ö'}]
            });
            renderCart();
        }

        window.updateNumberLot = function() {
            const input = document.getElementById('userNumber');
            const value = input.value.trim();
            if (value === '' || isNaN(value)) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ!');
                return;
            }
            const numberLot = menu.find(item => item.isNumberLot);
            numberLot.name = value;
            input.value = '';
            renderMenu();
        }

        // –ö–æ—Ä–∑–∏–Ω–∞
        function renderCart() {
            const cartBox = document.getElementById('cartBox');
            const items = Object.keys(cart)
                .filter(idx => cart[idx] > 0)
                .map(idx => ({...menu[idx], count: cart[idx], idx: Number(idx)}));
            if (items.length === 0) {
                cartBox.classList.remove('visible');
                appliedPromo = null;
                promoMessage = '';
                cartBox.innerHTML = '';
                return;
            }
            let total = 0;
            let listHtml = '';
            items.forEach(item => {
                const price = getPrice(item);
                total += price * item.count;
                listHtml += `<div class="cart-item">
                    <span>${item.img} ${item.name} √ó ${item.count}</span>
                    <span>${price * item.count} —Ä—É–±.</span>
                </div>`;
            });

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
            let promoText = '';
            let discount = 0;
            if (appliedPromo) {
                if (appliedPromo.discount < 1) {
                    discount = Math.floor(total * appliedPromo.discount);
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (-${discount} —Ä—É–±.)`;
                } else if (appliedPromo.min && total >= appliedPromo.min) {
                    discount = appliedPromo.discount;
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (-${discount} —Ä—É–±.)`;
                } else if (!appliedPromo.min) {
                    discount = appliedPromo.discount;
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (-${discount} —Ä—É–±.)`;
                } else {
                    promoText = `–ü—Ä–æ–º–æ–∫–æ–¥: ${appliedPromo.code} (–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ª–æ–≤–∏—è)`;
                }
            }
            let totalWithDiscount = Math.max(total - discount, 0);

            cartBox.innerHTML = `
                <div class="cart-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <div class="cart-list">${listHtml}</div>
                <div class="cart-total">–ò—Ç–æ–≥–æ: ${totalWithDiscount} —Ä—É–±–ª–µ–π</div>
                ${promoText ? `<div style="color:#1a8f1a; font-size:14px; margin-bottom:8px;">${promoText}</div>` : ''}
                <form class="promo-input-block" onsubmit="applyPromo(event)">
                    <input type="text" id="promoInput" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" autocomplete="off" value="${appliedPromo ? appliedPromo.code : ''}">
                    <button type="submit" class="promo-btn-apply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                </form>
                ${promoMessage ? `<div class="promo-message${promoMessage === '–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!' ? ' success' : ''}">${promoMessage}</div>` : ''}
                <button class="cart-btn pay-btn" onclick="payOrder()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            `;
            cartBox.classList.add('visible');
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
        window.applyPromo = function(event) {
            event.preventDefault();
            const input = document.getElementById('promoInput');
            const code = input.value.trim();
            if (!code) {
                promoMessage = '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥!';
                renderCart();
                return;
            }
            const promo = promoCodes.find(p => p.code.toLowerCase() === code.toLowerCase());
            if (promo) {
                appliedPromo = promo;
                promoMessage = '–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!';
            } else {
                appliedPromo = null;
                promoMessage = '–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω.';
            }
            renderCart();
        }

        window.payOrder = function() {
            alert('–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ (–ø—Ä–∏–º–µ—Ä)');
        }

        // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
        function renderPromoList() {
            const promoList = document.getElementById('promoList');
            promoList.innerHTML = promoCodes.map(p =>
                `<li><b>${p.code}</b> ‚Äî ${p.desc}</li>`
            ).join('');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        document.getElementById('togglePromoList').onclick = function() {
            const box = document.getElementById('promoListBox');
            if (box.classList.contains('visible')) {
                box.classList.remove('visible');
                setTimeout(() => { box.style.display = 'none'; }, 350);
                this.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã';
            } else {
                box.style.display = 'block';
                setTimeout(() => { box.classList.add('visible'); }, 10);
                this.textContent = '–°–∫—Ä—ã—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã';
            }
        };

        renderPromoList();
        renderMenu();
    </script>
</body>
</html>
